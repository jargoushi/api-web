# è§†é¢‘å¯¼å‡ºåŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ¬ åŠŸèƒ½æ¦‚è¿°

è§†é¢‘å¯¼å‡ºæœåŠ¡å¯ä»¥è‡ªåŠ¨æ§åˆ¶å‰ªæ˜ å¯¼å‡ºè‰ç¨¿ä¸ºè§†é¢‘æ–‡ä»¶ï¼Œæ”¯æŒï¼š

- âœ… å•ä¸ªè‰ç¨¿å¯¼å‡º
- âœ… æ‰¹é‡è‰ç¨¿å¯¼å‡º
- âœ… è‡ªå®šä¹‰åˆ†è¾¨ç‡ï¼ˆ720p/1080p/2K/4Kï¼‰
- âœ… è‡ªå®šä¹‰å¸§ç‡ï¼ˆ24/30/60fpsï¼‰
- âœ… è‡ªåŠ¨åŒ–å¯¼å‡ºæµç¨‹

---

## âš ï¸ é‡è¦å‰ææ¡ä»¶

åœ¨ä½¿ç”¨å¯¼å‡ºåŠŸèƒ½å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. **å‰ªæ˜ å·²æ‰“å¼€** - å¿…é¡»å…ˆå¯åŠ¨å‰ªæ˜ åº”ç”¨
2. **åœ¨è‰ç¨¿é¡µé¢** - å¿…é¡»åœ¨è‰ç¨¿åˆ—è¡¨é¡µé¢ï¼Œä¸èƒ½åœ¨ç¼–è¾‘é¡µé¢
3. **è‰ç¨¿å·²ä¿å­˜** - è¦å¯¼å‡ºçš„è‰ç¨¿å¿…é¡»å·²ç»ä¿å­˜
4. **ä¸è¦æ“ä½œ** - å¯¼å‡ºè¿‡ç¨‹ä¸­ä¸è¦æ“ä½œå‰ªæ˜ ç•Œé¢

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•å¯¼å‡ºåŠŸèƒ½

```bash
# è¿è¡Œå¯¼å‡ºæµ‹è¯•
python run_export_test.py
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š

- æµ‹è¯•å•ä¸ªè‰ç¨¿å¯¼å‡º
- å¯é€‰æµ‹è¯•æ‰¹é‡å¯¼å‡º
- æ£€æŸ¥å¯¼å‡ºæ–‡ä»¶æ˜¯å¦æˆåŠŸ

### 2. æ‰¹é‡å¯¼å‡ºå˜ä½“

```bash
# è¿è¡Œå˜ä½“å¯¼å‡ºå·¥å…·
python run_export_variants.py
```

è¿™ä¸ªè„šæœ¬æä¾›ï¼š

- å¯¼å‡ºæ‰€æœ‰å˜ä½“ï¼ˆ6 ä¸ªï¼‰
- é€‰æ‹©æ€§å¯¼å‡ºï¼ˆéšæœº/ä¸»é¢˜/å…¨éƒ¨ï¼‰
- è‡ªåŠ¨ç»„ç»‡å¯¼å‡ºæ–‡ä»¶

---

## ğŸ“š ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šå•ä¸ªè‰ç¨¿å¯¼å‡º

```python
from app.services.video_generation import export_service

# å¯¼å‡ºå•ä¸ªè‰ç¨¿
export_path = await export_service.export_draft(
    draft_name="æˆ‘çš„è‰ç¨¿",
    export_path="./exports/my_video.mp4",
    resolution="1080p",  # 720p/1080p/2k/4k
    framerate=30         # 24/30/60
)

print(f"å¯¼å‡ºæˆåŠŸï¼š{export_path}")
```

### æ–¹æ³• 2ï¼šæ‰¹é‡å¯¼å‡º

```python
from app.services.video_generation import export_service

# æ‰¹é‡å¯¼å‡ºå¤šä¸ªè‰ç¨¿
draft_names = [
    "è‰ç¨¿1",
    "è‰ç¨¿2",
    "è‰ç¨¿3"
]

exported_paths = await export_service.batch_export(
    draft_names=draft_names,
    export_folder="./exports",
    resolution="1080p",
    framerate=30
)

print(f"æˆåŠŸå¯¼å‡º {len(exported_paths)} ä¸ªè§†é¢‘")
```

### æ–¹æ³• 3ï¼šå¯¼å‡ºå˜ä½“è§†é¢‘

```python
from app.services.video_generation import auto_variant_service, export_service

# 1. ç”Ÿæˆå˜ä½“
variants = await auto_variant_service.generate_variants(
    source_video_path="materials/videos/my_video.mp4",
    base_name="æˆ‘çš„è§†é¢‘",
    variant_count=5
)

# 2. æå–è‰ç¨¿åç§°
draft_names = [v['name'] for v in variants]

# 3. æ‰¹é‡å¯¼å‡º
exported_paths = await export_service.batch_export(
    draft_names=draft_names,
    export_folder="./exports/variants",
    resolution="1080p",
    framerate=30
)
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### åˆ†è¾¨ç‡é€‰é¡¹

| é€‰é¡¹    | è¯´æ˜      | é€‚ç”¨åœºæ™¯           |
| ------- | --------- | ------------------ |
| `720p`  | 1280x720  | å¿«é€Ÿé¢„è§ˆã€ç¤¾äº¤åª’ä½“ |
| `1080p` | 1920x1080 | æ ‡å‡†é«˜æ¸…ã€é€šç”¨åœºæ™¯ |
| `2k`    | 2560x1440 | é«˜è´¨é‡è§†é¢‘         |
| `4k`    | 3840x2160 | è¶…é«˜æ¸…ã€ä¸“ä¸šåˆ¶ä½œ   |

### å¸§ç‡é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜     | é€‚ç”¨åœºæ™¯           |
| ---- | -------- | ------------------ |
| `24` | ç”µå½±æ ‡å‡† | ç”µå½±æ„Ÿã€è‰ºæœ¯è§†é¢‘   |
| `30` | æ ‡å‡†å¸§ç‡ | é€šç”¨è§†é¢‘ã€ç½‘ç»œè§†é¢‘ |
| `60` | é«˜å¸§ç‡   | æµç•…åŠ¨ä½œã€æ¸¸æˆè§†é¢‘ |

---

## ğŸ“ å¯¼å‡ºæ–‡ä»¶ç»„ç»‡

### æ¨èçš„æ–‡ä»¶å¤¹ç»“æ„

```
exports/
â”œâ”€â”€ variants/           # å˜ä½“è§†é¢‘
â”‚   â”œâ”€â”€ éšæœºå˜ä½“æµ‹è¯•_å˜ä½“1.mp4
â”‚   â”œâ”€â”€ éšæœºå˜ä½“æµ‹è¯•_å˜ä½“2.mp4
â”‚   â””â”€â”€ ...
â”œâ”€â”€ themed/            # ä¸»é¢˜è§†é¢‘
â”‚   â”œâ”€â”€ å•†åŠ¡ç‰ˆ.mp4
â”‚   â”œâ”€â”€ æ´»æ³¼ç‰ˆ.mp4
â”‚   â””â”€â”€ ...
â”œâ”€â”€ final/             # æœ€ç»ˆç‰ˆæœ¬
â”‚   â””â”€â”€ æœ€ç»ˆç‰ˆ.mp4
â””â”€â”€ preview/           # é¢„è§ˆç‰ˆæœ¬ï¼ˆä½åˆ†è¾¨ç‡ï¼‰
    â””â”€â”€ é¢„è§ˆ.mp4
```

### è‡ªåŠ¨å‘½åè§„åˆ™

```python
# ä½¿ç”¨è‰ç¨¿åç§°ä½œä¸ºæ–‡ä»¶å
export_path = f"./exports/{draft_name}.mp4"

# æ·»åŠ æ—¶é—´æˆ³
from datetime import datetime
timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
export_path = f"./exports/{draft_name}_{timestamp}.mp4"

# æŒ‰åˆ†è¾¨ç‡åˆ†ç±»
export_path = f"./exports/{resolution}/{draft_name}.mp4"
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: å¯¼å‡ºå¤±è´¥ï¼Œæç¤º"åˆå§‹åŒ–å‰ªæ˜ æ§åˆ¶å™¨å¤±è´¥"

**åŸå› ï¼š**

- å‰ªæ˜ æœªæ‰“å¼€
- å‰ªæ˜ ä¸åœ¨è‰ç¨¿é¡µé¢
- å‰ªæ˜ ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ–¹æ³•ï¼š**

1. æ‰“å¼€å‰ªæ˜ åº”ç”¨
2. ç¡®ä¿åœ¨è‰ç¨¿åˆ—è¡¨é¡µé¢ï¼ˆä¸æ˜¯ç¼–è¾‘é¡µé¢ï¼‰
3. æ£€æŸ¥å‰ªæ˜ ç‰ˆæœ¬æ˜¯å¦æ”¯æŒ

### Q2: å¯¼å‡ºçš„è§†é¢‘æ–‡ä»¶å¾ˆå°æˆ–æŸå

**åŸå› ï¼š**

- è‰ç¨¿å†…å®¹ä¸ºç©º
- å¯¼å‡ºè¿‡ç¨‹è¢«ä¸­æ–­
- ç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ³•ï¼š**

1. æ£€æŸ¥è‰ç¨¿æ˜¯å¦æœ‰å†…å®¹
2. å¯¼å‡ºè¿‡ç¨‹ä¸­ä¸è¦æ“ä½œå‰ªæ˜ 
3. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´

### Q3: æ‰¹é‡å¯¼å‡ºæ—¶æŸäº›è§†é¢‘å¤±è´¥

**åŸå› ï¼š**

- è‰ç¨¿åç§°ä¸å­˜åœ¨
- è‰ç¨¿å·²è¢«åˆ é™¤
- å¯¼å‡ºè·¯å¾„å†²çª

**è§£å†³æ–¹æ³•ï¼š**

1. æ£€æŸ¥è‰ç¨¿æ˜¯å¦å­˜åœ¨
2. ä½¿ç”¨å”¯ä¸€çš„æ–‡ä»¶å
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### Q4: å¯¼å‡ºé€Ÿåº¦å¾ˆæ…¢

**åŸå› ï¼š**

- é«˜åˆ†è¾¨ç‡å¯¼å‡ºéœ€è¦æ›´å¤šæ—¶é—´
- è‰ç¨¿å†…å®¹å¤æ‚ï¼ˆç‰¹æ•ˆå¤šï¼‰
- ç”µè„‘æ€§èƒ½é™åˆ¶

**è§£å†³æ–¹æ³•ï¼š**

1. ä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡è¿›è¡Œé¢„è§ˆ
2. ç®€åŒ–è‰ç¨¿å†…å®¹
3. å…³é—­å…¶ä»–å ç”¨èµ„æºçš„ç¨‹åº

### Q5: å¯¼å‡ºåæ‰¾ä¸åˆ°æ–‡ä»¶

**åŸå› ï¼š**

- å¯¼å‡ºè·¯å¾„é”™è¯¯
- æ–‡ä»¶è¢«ç§»åŠ¨æˆ–åˆ é™¤
- æƒé™é—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**

1. ä½¿ç”¨ç»å¯¹è·¯å¾„
2. æ£€æŸ¥å¯¼å‡ºæ—¥å¿—ä¸­çš„è·¯å¾„
3. ç¡®ä¿æœ‰å†™å…¥æƒé™

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆ†é˜¶æ®µå¯¼å‡º

```python
# ç¬¬ä¸€é˜¶æ®µï¼šä½åˆ†è¾¨ç‡é¢„è§ˆ
await export_service.export_draft(
    draft_name="æˆ‘çš„è‰ç¨¿",
    export_path="./exports/preview/preview.mp4",
    resolution="720p",
    framerate=30
)

# æ£€æŸ¥é¢„è§ˆåï¼Œå†å¯¼å‡ºé«˜åˆ†è¾¨ç‡
await export_service.export_draft(
    draft_name="æˆ‘çš„è‰ç¨¿",
    export_path="./exports/final/final.mp4",
    resolution="4k",
    framerate=60
)
```

### 2. é”™è¯¯å¤„ç†

```python
try:
    export_path = await export_service.export_draft(
        draft_name="æˆ‘çš„è‰ç¨¿",
        export_path="./exports/my_video.mp4"
    )
    print(f"âœ“ å¯¼å‡ºæˆåŠŸï¼š{export_path}")
except Exception as e:
    print(f"âœ— å¯¼å‡ºå¤±è´¥ï¼š{e}")
    # è®°å½•é”™è¯¯æ—¥å¿—
    # å‘é€é€šçŸ¥
    # é‡è¯•å¯¼å‡º
```

### 3. æ‰¹é‡å¯¼å‡ºè¿›åº¦è·Ÿè¸ª

```python
draft_names = ["è‰ç¨¿1", "è‰ç¨¿2", "è‰ç¨¿3"]

for i, draft_name in enumerate(draft_names, 1):
    print(f"å¯¼å‡ºè¿›åº¦ï¼š{i}/{len(draft_names)}")
    try:
        await export_service.export_draft(
            draft_name=draft_name,
            export_path=f"./exports/{draft_name}.mp4"
        )
        print(f"âœ“ {draft_name} å¯¼å‡ºæˆåŠŸ")
    except Exception as e:
        print(f"âœ— {draft_name} å¯¼å‡ºå¤±è´¥ï¼š{e}")
```

### 4. å¯¼å‡ºåè‡ªåŠ¨å¤„ç†

```python
import os

# å¯¼å‡ºè§†é¢‘
export_path = await export_service.export_draft(
    draft_name="æˆ‘çš„è‰ç¨¿",
    export_path="./exports/my_video.mp4"
)

# æ£€æŸ¥æ–‡ä»¶å¤§å°
file_size = os.path.getsize(export_path) / (1024 * 1024)
print(f"æ–‡ä»¶å¤§å°ï¼š{file_size:.2f} MB")

# è‡ªåŠ¨ä¸Šä¼ åˆ°äº‘å­˜å‚¨
# upload_to_cloud(export_path)

# å‘é€é€šçŸ¥
# send_notification(f"è§†é¢‘å¯¼å‡ºå®Œæˆï¼š{export_path}")
```

---

## ğŸ¯ å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

### ä»ç”Ÿæˆåˆ°å¯¼å‡ºçš„å®Œæ•´æµç¨‹

```python
import asyncio
from app.services.video_generation import (
    auto_variant_service,
    export_service
)

async def complete_workflow():
    """å®Œæ•´çš„è§†é¢‘ç”Ÿæˆå’Œå¯¼å‡ºæµç¨‹"""

    # 1. ç”Ÿæˆå˜ä½“
    print("æ­¥éª¤1ï¼šç”Ÿæˆè§†é¢‘å˜ä½“...")
    variants = await auto_variant_service.generate_variants(
        source_video_path="materials/videos/source.mp4",
        base_name="äº§å“å®£ä¼ ",
        variant_count=5
    )
    print(f"âœ“ ç”Ÿæˆäº† {len(variants)} ä¸ªå˜ä½“")

    # 2. æå–è‰ç¨¿åç§°
    draft_names = [v['name'] for v in variants]

    # 3. å¯¼å‡ºé¢„è§ˆç‰ˆæœ¬ï¼ˆå¿«é€Ÿï¼‰
    print("\næ­¥éª¤2ï¼šå¯¼å‡ºé¢„è§ˆç‰ˆæœ¬...")
    await export_service.batch_export(
        draft_names=draft_names,
        export_folder="./exports/preview",
        resolution="720p",
        framerate=30
    )
    print("âœ“ é¢„è§ˆç‰ˆæœ¬å¯¼å‡ºå®Œæˆ")

    # 4. äººå·¥å®¡æ ¸ï¼ˆå¯é€‰ï¼‰
    print("\næ­¥éª¤3ï¼šè¯·å®¡æ ¸é¢„è§ˆç‰ˆæœ¬...")
    input("å®¡æ ¸å®ŒæˆåæŒ‰ Enter ç»§ç»­...")

    # 5. å¯¼å‡ºæœ€ç»ˆç‰ˆæœ¬ï¼ˆé«˜è´¨é‡ï¼‰
    print("\næ­¥éª¤4ï¼šå¯¼å‡ºæœ€ç»ˆç‰ˆæœ¬...")
    await export_service.batch_export(
        draft_names=draft_names,
        export_folder="./exports/final",
        resolution="1080p",
        framerate=60
    )
    print("âœ“ æœ€ç»ˆç‰ˆæœ¬å¯¼å‡ºå®Œæˆ")

    print("\nâœ“ å®Œæ•´æµç¨‹æ‰§è¡Œå®Œæˆï¼")

# è¿è¡Œæµç¨‹
asyncio.run(complete_workflow())
```

---

## ğŸ“Š æ€§èƒ½å‚è€ƒ

### å¯¼å‡ºæ—¶é—´ä¼°ç®—ï¼ˆå‚è€ƒï¼‰

| è§†é¢‘é•¿åº¦ | 720p    | 1080p    | 2K       | 4K       |
| -------- | ------- | -------- | -------- | -------- |
| 30 ç§’    | ~30 ç§’  | ~1 åˆ†é’Ÿ  | ~2 åˆ†é’Ÿ  | ~5 åˆ†é’Ÿ  |
| 1 åˆ†é’Ÿ   | ~1 åˆ†é’Ÿ | ~2 åˆ†é’Ÿ  | ~4 åˆ†é’Ÿ  | ~10 åˆ†é’Ÿ |
| 5 åˆ†é’Ÿ   | ~5 åˆ†é’Ÿ | ~10 åˆ†é’Ÿ | ~20 åˆ†é’Ÿ | ~50 åˆ†é’Ÿ |

_æ³¨ï¼šå®é™…æ—¶é—´å–å†³äºç”µè„‘æ€§èƒ½å’Œè§†é¢‘å¤æ‚åº¦_

### æ–‡ä»¶å¤§å°ä¼°ç®—ï¼ˆå‚è€ƒï¼‰

| è§†é¢‘é•¿åº¦ | 720p   | 1080p  | 2K     | 4K     |
| -------- | ------ | ------ | ------ | ------ |
| 30 ç§’    | ~10MB  | ~20MB  | ~40MB  | ~100MB |
| 1 åˆ†é’Ÿ   | ~20MB  | ~40MB  | ~80MB  | ~200MB |
| 5 åˆ†é’Ÿ   | ~100MB | ~200MB | ~400MB | ~1GB   |

_æ³¨ï¼šå®é™…å¤§å°å–å†³äºè§†é¢‘å†…å®¹å’Œå‹ç¼©è®¾ç½®_

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è§†é¢‘ç”ŸæˆæœåŠ¡ README](./README.md)
- [è‡ªåŠ¨å˜ä½“ç”ŸæˆæŒ‡å—](./VARIANT_GENERATION_GUIDE.md)
- [æµ‹è¯•æŒ‡å—](../../test/VIDEO_GENERATION_TEST_GUIDE.md)

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`app/logs/`
2. æ£€æŸ¥å‰ªæ˜ ç‰ˆæœ¬å…¼å®¹æ€§
3. å‚è€ƒå¸¸è§é—®é¢˜éƒ¨åˆ†
4. æŸ¥çœ‹é”™è¯¯å †æ ˆä¿¡æ¯

---

**æœ€åæ›´æ–°ï¼š** 2025-12-05
